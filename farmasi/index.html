
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Farmasi</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Lato', sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100vh;
        }
        
        .cont-header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 100;
            min-height: 130px; /* Increased minimum height */
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .cont-footer {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 0.75rem;
            box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            z-index: 100;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .cont-farmasi {
            background-color: transparent;
            margin: 180px 20px 100px; /* Adjusted bottom margin for footer */
            padding: 0;
            height: calc(100vh - 300px); /* Adjusted for header and footer */
            position: relative;
            display: flex;
            gap: 20px;
        }
        
        .prescription-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        /* Non-racikan section styling */
        #non-racikan-section {
            background-color: #f0f7ff; /* Light blue background */
        }
        
        #non-racikan-section .section-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
            color: white;
            border-bottom: none;
        }
        
        #non-racikan-section thead {
            background-color: rgba(255, 255, 255, 0.7);
        }
        
        #non-racikan-section .table-body-container {
            background-color: rgba(255, 255, 255, 0.5);
        }
        
        /* Racikan section styling - now matching non-racikan */
        #racikan-section {
            background-color: #f0f7ff; /* Same light blue background */
        }
        
        #racikan-section .section-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%); /* Same blue gradient */
            color: white;
            border-bottom: none;
        }
        
        #racikan-section thead {
            background-color: rgba(255, 255, 255, 0.7);
        }
        
        #racikan-section .table-body-container {
            background-color: rgba(255, 255, 255, 0.5);
        }
        
        .section-header {
            padding: 1rem 1.5rem;
            font-weight: 700;
            font-size: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-count {
            background-color: rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 9999px;
            padding: 0.25rem 0.75rem;
            font-size: 1rem;
            font-weight: 700;
        }
        
        .header-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }
        
        .header-subtitle {
            font-size: 1rem;
            font-weight: 400;
            opacity: 0.9;
            margin: 0.25rem 0 0;
        }
        
        .prescription-item {
            transition: all 0.2s ease;
        }
        
        #non-racikan-section .prescription-item:hover,
        #racikan-section .prescription-item:hover {
            background-color: rgba(219, 234, 254, 0.7); /* Light blue hover for both */
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #64748b;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
        }
        
        /* Table styles */
        .table-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        thead {
            background-color: white;
        }
        
        thead th {
            font-size: 1.25rem !important;
            padding: 0.75rem 1.5rem !important;
            font-weight: 600;
        }
        
        tbody td {
            font-size: 1.25rem !important;
            padding: 0.75rem 1.5rem !important;
            line-height: 1.5 !important;
        }
        
        .table-body-container {
            overflow-y: auto;
            flex-grow: 1;
            padding-bottom: 20px; /* Add padding to prevent last item from being cut off */
        }
        
        /* Hide all scrollbars */
        .table-body-container::-webkit-scrollbar {
            display: none;
        }
        
        .table-body-container {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        
        /* Empty state larger text */
        .empty-state p.text-lg {
            font-size: 1.5rem !important;
        }
        
        .empty-state p.text-sm {
            font-size: 1rem !important;
        }
        
        .empty-state svg {
            width: 4rem;
            height: 4rem;
        }
        
        .last-update {
            font-size: 0.9rem;
            margin-top: 0.25rem;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            display: inline-flex;
            align-items: center;
        }
        
        .last-update-time {
            font-weight: 700;
            color: #f0f4ff;
        }
        
        /* Fixed column widths for better alignment */
        .col-patient {
            width: 45%;
        }
        
        .col-poli {
            width: 35%;
        }
        
        .col-time {
            width: 20%;
        }
        
        /* Background styling to emphasize the gap */
        .page-background {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f0f4f8;
            z-index: -1;
        }
        
        /* Ensure header content is fully visible */
        .header-content {
            width: 100%;
        }
        
        /* Status indicator */
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #10b981; /* Green color */
            margin-right: 8px;
            position: relative;
            display: inline-block;
        }
        
        /* Blinking animation */
        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.4; }
            100% { opacity: 1; }
        }
        
        .status-active {
            animation: blink 1.5s ease-in-out infinite;
            box-shadow: 0 0 5px #10b981;
        }
        
        /* Footer message styling */
        .footer-message {
            font-size: 1.2rem;
            font-weight: 500;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            padding: 0 20px;
            box-sizing: border-box;
        }
        
        /* Footer text styling for rotating messages */
        .footer-text {
            font-size: 1.3rem;
            font-weight: 500;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            padding: 0 20px;
            box-sizing: border-box;
          position: absolute;
          width: 100%;
          bottom: -100%;
          opacity: 0;
          transition: all 1s ease;
        }
        
        .footer-text.active {
          bottom: 0;
          opacity: 1;
        }
        
        /* Section empty state */
        .section-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 1rem;
            text-align: center;
        }
        
        #non-racikan-section .section-empty,
        #racikan-section .section-empty {
            color: rgba(37, 99, 235, 0.7); /* Same blue color for both */
        }
        
        .section-empty svg {
            width: 3rem;
            height: 3rem;
            margin-bottom: 1rem;
            opacity: 0.7;
        }
        
        /* Border styling for table rows */
        #non-racikan-section .prescription-item,
        #racikan-section .prescription-item {
            border-bottom: 1px solid rgba(37, 99, 235, 0.2); /* Same border color for both */
        }
        
        /* Overdue time styling */
        .time-overdue {
            color: #dc2626 !important; /* Red color */
            font-weight: 700 !important; /* Bold */
        }
        
        /* Next refresh indicator */
        .next-refresh {
            font-size: 0.8rem;
            margin-left: 10px;
            opacity: 0.8;
        }
        
        /* Service time info styling */
        .service-time-info {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            align-items: center;
            justify-content: flex-start;
            padding-top: 0.5rem;
        }
        
        .service-time-item {
            font-size: 1.1rem;
            font-weight: 600;
            color: white;
            text-align: center;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <div class="page-background"></div>
    
    <div class="cont-header">
        <div class="header-content flex justify-between items-start">
            <div>
                <h1 class="header-title">Dashboard Farmasi</h1>
                <h2 class="header-subtitle">RSU 'Aisyiyah Siti Fatimah Tulangan</h2>
            </div>
            <div class="text-center flex-1 mx-8">
                <div class="service-time-info">
                    <div class="service-time-item">Resep Non-Racikan &lt;30 MENIT</div>
                    <div class="service-time-item">Resep Racikan &lt;60 MENIT</div>
                </div>
            </div>
            <div class="text-right">
                <div class="text-xl font-bold" id="current-date"></div>
                <div class="text-lg" id="current-time"></div>
                <div class="last-update">
                    <span class="status-indicator status-active"></span>
                    <span>Pembaruan Terakhir: <span id="last-update-time" class="last-update-time">-</span></span>
                </div>
            </div>
        </div>
    </div>

    <div class="cont-farmasi">
        <!-- Non-Racikan Section -->
        <div class="prescription-section" id="non-racikan-section">
            <div class="section-header">
                <span>Resep Non-Racikan</span>
                <span class="section-count" id="non-racikan-count">0</span>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th class="text-left text-gray-700 col-patient">Nama Pasien</th>
                            <th class="text-left text-gray-700 col-poli">Poli</th>
                            <th class="text-right text-gray-700 col-time">Waktu Tunggu</th>
                        </tr>
                    </thead>
                </table>
                <div class="table-body-container" id="non-racikan-container">
                    <table>
                        <tbody id="non-racikan-list">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                </div>
                <div id="non-racikan-empty" class="section-empty">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <p class="text-lg font-medium">Tidak ada resep non-racikan</p>
                    <p class="text-sm mt-1">Data akan muncul secara otomatis</p>
                </div>
            </div>
        </div>
        
        <!-- Racikan Section -->
        <div class="prescription-section" id="racikan-section">
            <div class="section-header">
                <span>Resep Racikan</span>
                <span class="section-count" id="racikan-count">0</span>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th class="text-left text-gray-700 col-patient">Nama Pasien</th>
                            <th class="text-left text-gray-700 col-poli">Poli</th>
                            <th class="text-right text-gray-700 col-time">Waktu Tunggu</th>
                        </tr>
                    </thead>
                </table>
                <div class="table-body-container" id="racikan-container">
                    <table>
                        <tbody id="racikan-list">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                </div>
                <div id="racikan-empty" class="section-empty">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21c0 1.1-0.9 2-2 2H7c-1.1 0-2-0.9-2-2V5c0-1.1 0.9-2 2-2h5l7 7v11z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v7h7" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 15h8" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 18h5" />
                    </svg>
                    <p class="text-lg font-medium">Tidak ada resep racikan</p>
                    <p class="text-sm mt-1">Data akan muncul secara otomatis</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="cont-footer">
        <!--<div class="footer-message">
            RSU 'Aisyiyah Siti Fatimah Tulangan - Melayani dengan Sepenuh Hati - Jl. Raya Kenongo No. 14 Tulangan, Sidoarjo - Telp: (031) 885 1840
        </div>-->
        <div class="footer-text active">
            RSU 'Aisyiyah Siti Fatimah Tulangan - Melayani dengan Sepenuh Hati - 
            Jl. Raya Kenongo No. 14 Tulangan, Sidoarjo - Telp: (031) 885 1840
        </div>
        <div class="footer-text">
            Mohon menunggu, obat anda sedang diracik oleh tim kami
        </div>
    </div>

    <script>
        // Function to format date and time
        function formatDate(date) {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('id-ID', options);
        }
        
        function formatTime(date) {
            // Format with colons as separators
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }
        
        // Update current date and time
        function updateDateTime() {
            const now = new Date();
            document.getElementById('current-date').textContent = formatDate(now);
            document.getElementById('current-time').textContent = formatTime(now);
        }
        
        // Variables for refresh timing
        let lastRefreshTime = null;
        let nextRefreshTime = null;
        const REFRESH_INTERVAL = 60000; // 1 minute in milliseconds
        
        // Function to calculate time duration between two times
        function calculateTimeDuration(startTime, endTime = null) {
            try {
                // If no end time provided, use current time
                const now = new Date();
                const currentTime = formatTime(now);
                const targetEndTime = endTime || currentTime;
                
                // Parse time strings (format: HH:MM:SS)
                const parseTime = (timeStr) => {
                    const [hours, minutes, seconds] = timeStr.split(':').map(Number);
                    const date = new Date();
                    date.setHours(hours, minutes, seconds || 0, 0);
                    return date;
                };
                
                const start = parseTime(startTime);
                const end = parseTime(targetEndTime);
                
                // Calculate difference in milliseconds
                let diff = end - start;
                
                // If negative, it means we crossed midnight or end time is earlier
                if (diff < 0) {
                    diff += 24 * 60 * 60 * 1000; // Add 24 hours
                }
                
                // Convert to hours, minutes, seconds
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                // Format output in hh:mm:ss format
                const hoursStr = String(hours).padStart(2, '0');
                const minutesStr = String(minutes).padStart(2, '0');
                const secondsStr = String(seconds).padStart(2, '0');
                
                return `${hoursStr}:${minutesStr}:${secondsStr}`;
            } catch (error) {
                return '-';
            }
        }
        
        // Function to check if time is overdue based on prescription type
        function isTimeOverdue(startTime, endTime, prescriptionType) {
            try {
                // If no end time provided, use current time
                const now = new Date();
                const currentTime = formatTime(now);
                const targetEndTime = endTime || currentTime;
                
                // Parse time strings (format: HH:MM:SS)
                const parseTime = (timeStr) => {
                    const [hours, minutes, seconds] = timeStr.split(':').map(Number);
                    const date = new Date();
                    date.setHours(hours, minutes, seconds || 0, 0);
                    return date;
                };
                
                const start = parseTime(startTime);
                const end = parseTime(targetEndTime);
                
                // Calculate difference in milliseconds
                let diff = end - start;
                
                // If negative, it means we crossed midnight or end time is earlier
                if (diff < 0) {
                    diff += 24 * 60 * 60 * 1000; // Add 24 hours
                }
                
                // Convert to minutes
                const totalMinutes = Math.floor(diff / (1000 * 60));
                
                // Check if overdue based on prescription type
                if (prescriptionType === 'non-racikan') {
                    return totalMinutes > 30; // Over 30 minutes
                } else if (prescriptionType === 'racikan') {
                    return totalMinutes > 60; // Over 60 minutes
                }
                
                return false;
            } catch (error) {
                return false;
            }
        }
        
        // Function to update real-time durations
        function updateRealTimeDurations() {
            // Update non-racikan durations
            const nonRacikanRows = document.querySelectorAll('#non-racikan-list tr');
            nonRacikanRows.forEach(row => {
                const startTime = row.dataset.startTime;
                const endTime = row.dataset.endTime;
                const prescriptionType = row.dataset.prescriptionType;
                if (startTime) {
                    const timeCell = row.querySelector('.col-time');
                    if (timeCell) {
                        timeCell.textContent = calculateTimeDuration(startTime, endTime);
                        
                        // Check if overdue and apply styling
                        if (isTimeOverdue(startTime, endTime, prescriptionType)) {
                            timeCell.classList.add('time-overdue');
                        } else {
                            timeCell.classList.remove('time-overdue');
                        }
                    }
                }
            });
            
            // Update racikan durations
            const racikanRows = document.querySelectorAll('#racikan-list tr');
            racikanRows.forEach(row => {
                const startTime = row.dataset.startTime;
                const endTime = row.dataset.endTime;
                const prescriptionType = row.dataset.prescriptionType;
                if (startTime) {
                    const timeCell = row.querySelector('.col-time');
                    if (timeCell) {
                        timeCell.textContent = calculateTimeDuration(startTime, endTime);
                        
                        // Check if overdue and apply styling
                        if (isTimeOverdue(startTime, endTime, prescriptionType)) {
                            timeCell.classList.add('time-overdue');
                        } else {
                            timeCell.classList.remove('time-overdue');
                        }
                    }
                }
            });
        }
        
        // Function to fetch prescription data
        async function fetchPrescriptions() {
            try {
                // Set refresh times
                lastRefreshTime = new Date();
                nextRefreshTime = new Date(lastRefreshTime.getTime() + REFRESH_INTERVAL);
                
                // Updated API endpoint
                const response = await fetch('https://project.rsaisyiyahsitifatimah.com/api/resep-obat');
                const data = await response.json();
                
                if (data.success && data.data) {
                    renderPrescriptions(data.data);
                } else {
                    showEmptyState();
                }
                
                const now = new Date();
                const lastUpdateTime = document.getElementById('last-update-time');
                lastUpdateTime.textContent = formatTime(now);
                
                // Flash effect for update time
                lastUpdateTime.style.transition = 'none';
                lastUpdateTime.style.backgroundColor = '#ffffff';
                lastUpdateTime.style.color = '#1e40af';
                lastUpdateTime.style.padding = '0 4px';
                lastUpdateTime.style.borderRadius = '2px';
                
                // Update status indicator to show active (always reset to green on successful fetch)
                const statusIndicator = document.querySelector('.status-indicator');
                statusIndicator.style.backgroundColor = '#10b981'; // Green color
                statusIndicator.style.boxShadow = '0 0 5px #10b981';
                statusIndicator.classList.add('status-active');
                
                setTimeout(() => {
                    lastUpdateTime.style.transition = 'all 1s ease';
                    lastUpdateTime.style.backgroundColor = 'transparent';
                    lastUpdateTime.style.color = '#f0f4ff';
                }, 50);
            } catch (error) {
                console.error('Error fetching data:', error);
                showEmptyState();
                document.getElementById('last-update-time').textContent = 'Gagal';
                
                // Update status indicator to show error
                const statusIndicator = document.querySelector('.status-indicator');
                statusIndicator.classList.remove('status-active');
                statusIndicator.style.backgroundColor = '#ef4444'; // Red color for error
                statusIndicator.style.boxShadow = '0 0 5px #ef4444';
            }
        }
        
        // Function to check if prescription should be hidden (disabled - show all patients)
        function shouldHidePrescription(prescription) {
            // Always return false to show all patients regardless of validation status
            return false;
        }
        
        // Function to render prescriptions
        function renderPrescriptions(prescriptions) {
            // Filter out prescriptions that should be hidden (validated + past grace period)
            const visiblePrescriptions = prescriptions.filter(p => !shouldHidePrescription(p));
            
            // Sort by no_resep in descending order (newest first)
            visiblePrescriptions.sort((a, b) => {
                // First compare by date if available
                if (a.tgl_peresepan !== b.tgl_peresepan) {
                    return b.tgl_peresepan.localeCompare(a.tgl_peresepan);
                }
                // Then by time
                if (a.jam_peresepan !== b.jam_peresepan) {
                    return b.jam_peresepan.localeCompare(a.jam_peresepan);
                }
                // Finally by no_resep
                return b.no_resep.localeCompare(a.no_resep);
            });
            
            // Split prescriptions by type
            const racikanPrescriptions = visiblePrescriptions.filter(p => p.jenis_resep === 'racikan');
            const nonRacikanPrescriptions = visiblePrescriptions.filter(p => p.jenis_resep === 'non-racikan');
            
            // Update counters
            document.getElementById('racikan-count').textContent = racikanPrescriptions.length;
            document.getElementById('non-racikan-count').textContent = nonRacikanPrescriptions.length;
            
            // Render each section
            renderSectionPrescriptions('racikan', racikanPrescriptions);
            renderSectionPrescriptions('non-racikan', nonRacikanPrescriptions);
        }
        
        // Function to render prescriptions for a specific section
        function renderSectionPrescriptions(sectionType, prescriptions) {
            const listElement = document.getElementById(`${sectionType}-list`);
            const containerElement = document.getElementById(`${sectionType}-container`);
            const emptyElement = document.getElementById(`${sectionType}-empty`);
            
            if (prescriptions.length === 0) {
                // Show empty state for this section
                emptyElement.style.display = 'flex';
                containerElement.style.display = 'none';
                return;
            }
            
            // Show the container and hide empty state
            emptyElement.style.display = 'none';
            containerElement.style.display = 'block';
            
            // Clear previous content
            listElement.innerHTML = '';
            
            // Add prescription items
            prescriptions.forEach(prescription => {
                const row = document.createElement('tr');
                row.className = 'prescription-item';
                
                // Format the jam_peresepan to ensure it uses colons
                let startTime = prescription.jam_peresepan;
                if (startTime && startTime.includes('.')) {
                    startTime = startTime.replace(/\./g, ':');
                }
                
                // Format the jam_penyerahan if it exists and is not 00:00:00
                let endTime = null;
                if (prescription.jam_penyerahan && prescription.jam_penyerahan !== '00:00:00' && prescription.jam_penyerahan !== '00.00.00') {
                    endTime = prescription.jam_penyerahan;
                    if (endTime.includes('.')) {
                        endTime = endTime.replace(/\./g, ':');
                    }
                }
                
                // Calculate duration
                const duration = calculateTimeDuration(startTime, endTime);
                
                // Check if overdue for initial styling
                const isOverdue = isTimeOverdue(startTime, endTime, sectionType);
                const timeClass = isOverdue ? 'text-right text-gray-700 col-time time-overdue' : 'text-right text-gray-700 col-time';
                
                row.innerHTML = `
                    <td class="text-gray-800 font-medium col-patient">${prescription.nm_pasien}</td>
                    <td class="text-gray-700 col-poli">${prescription.nm_poli}</td>
                    <td class="${timeClass}">${duration}</td>
                `;
                
                // Store time data for real-time updates
                row.dataset.noResep = prescription.no_resep;
                row.dataset.startTime = startTime;
                row.dataset.prescriptionType = sectionType;
                if (endTime) {
                    row.dataset.endTime = endTime;
                }
                
                listElement.appendChild(row);
            });
            
            // Start auto-scroll for this section if needed
            startAutoScroll(sectionType);
        }
        
        // Auto-scroll animation IDs for each section
        let scrollAnimationIds = {
            'racikan': null,
            'non-racikan': null
        };
        
        // Scroll positions for each section
        let scrollPositions = {
            'racikan': 0,
            'non-racikan': 0
        };
        

        
        // Auto-scroll function with smooth animation
        function startAutoScroll(sectionType) {
            // Clear any existing animation for this section
            if (scrollAnimationIds[sectionType]) {
                clearInterval(scrollAnimationIds[sectionType]);
                scrollAnimationIds[sectionType] = null;
            }
            
            const container = document.getElementById(`${sectionType}-container`);
            if (!container) return;
            
            // Recalculate dimensions each time to handle dynamic content
            const getScrollDimensions = () => {
                return {
                    scrollHeight: container.scrollHeight,
                    clientHeight: container.clientHeight,
                    maxScroll: container.scrollHeight - container.clientHeight
                };
            };
            
            const { scrollHeight, clientHeight, maxScroll } = getScrollDimensions();
            
            // Only auto-scroll if content exceeds visible area by a meaningful amount
            if (maxScroll <= 10) {
                return;
            }
            
            let currentPhase = 'pause-top'; // 'pause-top', 'scrolling', 'pause-bottom'
            let scrollPosition = 0;
            let phaseTimer = 0;
            
            const scrollSpeed = 1; // pixels per step
            const pauseDuration = 100; // 100 * 20ms = 2 seconds pause
            const stepInterval = 20; // milliseconds between steps
            
            function scrollStep() {
                // Recalculate dimensions to handle dynamic content changes
                const dims = getScrollDimensions();
                
                // If content no longer needs scrolling, stop
                if (dims.maxScroll <= 10) {
                    clearInterval(scrollAnimationIds[sectionType]);
                    scrollAnimationIds[sectionType] = null;
                    return;
                }
                
                switch (currentPhase) {
                    case 'pause-top':
                        phaseTimer++;
                        if (phaseTimer >= pauseDuration) {
                            currentPhase = 'scrolling';
                            phaseTimer = 0;
                            scrollPosition = 0;
                        }
                        break;
                        
                    case 'scrolling':
                        scrollPosition += scrollSpeed;
                        
                        // Ensure we don't scroll past the maximum
                        if (scrollPosition >= dims.maxScroll) {
                            scrollPosition = dims.maxScroll;
                            container.scrollTop = scrollPosition;
                            currentPhase = 'pause-bottom';
                            phaseTimer = 0;
                        } else {
                            container.scrollTop = scrollPosition;
                        }
                        break;
                        
                    case 'pause-bottom':
                        phaseTimer++;
                        if (phaseTimer >= pauseDuration) {
                            // Reset to top
                            scrollPosition = 0;
                            container.scrollTop = 0;
                            currentPhase = 'pause-top';
                            phaseTimer = 0;
                        }
                        break;
                }
            }
            
            // Start the animation
            scrollAnimationIds[sectionType] = setInterval(scrollStep, stepInterval);
        }
        
        function showEmptyState() {
            // Show empty state for both sections
            document.getElementById('racikan-empty').style.display = 'flex';
            document.getElementById('non-racikan-empty').style.display = 'flex';
            document.getElementById('racikan-container').style.display = 'none';
            document.getElementById('non-racikan-container').style.display = 'none';
            
            // Update counters
            document.getElementById('racikan-count').textContent = '0';
            document.getElementById('non-racikan-count').textContent = '0';
            
            // Clear auto-scroll if active
            Object.keys(scrollAnimationIds).forEach(key => {
                if (scrollAnimationIds[key]) {
                    clearInterval(scrollAnimationIds[key]);
                    scrollAnimationIds[key] = null;
                }
            });
        }
        
        // Initialize
        function initialize() {
            updateDateTime();
            fetchPrescriptions();
            
            // Update date and time every second
            setInterval(updateDateTime, 1000);
            
            // Update real-time durations every second
            setInterval(updateRealTimeDurations, 1000);
            
            // Refresh data every minute
            setInterval(() => {
                fetchPrescriptions();
            }, REFRESH_INTERVAL);
            
            // Handle visibility changes (tab switching)
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'visible') {
                    fetchPrescriptions();
                }
            });
            
            // Adjust layout based on content height
            const adjustHeaderHeight = () => {
                const header = document.querySelector('.cont-header');
                const headerContent = document.querySelector('.header-content');
                if (headerContent && header) {
                    const contentHeight = headerContent.offsetHeight;
                    header.style.height = 'auto';
                    header.style.minHeight = Math.max(130, contentHeight + 30) + 'px';
                }
            };
            
            // Run once on load and whenever window resizes
            window.addEventListener('load', adjustHeaderHeight);
            window.addEventListener('resize', adjustHeaderHeight);
        }
        
        // Function footer
        const footers = document.querySelectorAll('.footer-text');
        let current = 0;
    
        setInterval(() => {
          footers[current].classList.remove('active');
          current = (current + 1) % footers.length;
          footers[current].classList.add('active');
        }, 10000); // 10 detik
        
        // Start the application
        document.addEventListener('DOMContentLoaded', () => {
            initialize();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98ec37e2523291b4',t:'MTc2MDQ5ODgyMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
