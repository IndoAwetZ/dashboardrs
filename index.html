<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Antrian Poli</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Lato', sans-serif;
      background: linear-gradient(135deg, #f0f6ff, #dbeafe);
      margin: 0;
      overflow: hidden;
    }
    .glass {
      background: rgba(255, 255, 255, 0.3);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
  </style>
</head>
<body class="flex flex-col h-screen w-screen text-gray-900">

  <!-- Header -->
  <header class="glass fixed top-0 left-0 w-full flex justify-between items-center px-10 py-3 text-blue-900 shadow-md">
    <div class="text-2xl font-bold">Dashboard Antrian Poli Spesialis</div>
    <div class="text-center flex-1">
      <div id="clock" class="text-4xl font-bold tracking-wider"></div>
    </div>
    <div id="date" class="text-lg font-medium"></div>
  </header>

  <!-- Konten utama -->
  <main id="content" class="flex-grow mt-20 mb-16 overflow-hidden p-6">
    <div id="pages" class="h-full w-full flex items-center justify-center text-center">
      <div class="text-gray-700 text-xl">Memuat data antrian...</div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="glass fixed bottom-0 left-0 w-full flex justify-between items-center px-8 py-2 text-blue-900 text-lg">
    <div>RS Aisyiyah Siti Fatimah â€“ Sistem Antrian</div>
    <div id="lastUpdate">Terakhir diperbarui: --:--:--</div>
  </footer>

  <script>
    const clock = document.getElementById('clock');
    const dateEl = document.getElementById('date');
    const lastUpdate = document.getElementById('lastUpdate');
    const pages = document.getElementById('pages');

    function updateClock() {
      const now = new Date();
      const jam = now.toLocaleTimeString('id-ID', { hour12: false });
      clock.textContent = jam;

      const hari = now.toLocaleDateString('id-ID', { weekday: 'long' });
      const tanggal = now.toLocaleDateString('id-ID', {
        day: 'numeric',
        month: 'long',
        year: 'numeric',
      });
      dateEl.textContent = `${hari}, ${tanggal}`;
    }
    setInterval(updateClock, 1000);
    updateClock();

    async function fetchData() {
      try {
        const res = await fetch('https://project.rsaisyiyahsitifatimah.com/api/reg-periksa');
        const json = await res.json();
        if (json.success && Array.isArray(json.data)) {
          const filtered = json.data.filter(
            (item) =>
              item.nm_dokter.toLowerCase() !== 'admin' &&
              item.nm_poli.toLowerCase() !== 'igd'
          );

          const grouped = filtered.reduce((acc, item) => {
            if (!acc[item.nm_poli]) acc[item.nm_poli] = {};
            if (!acc[item.nm_poli][item.nm_dokter]) acc[item.nm_poli][item.nm_dokter] = [];
            acc[item.nm_poli][item.nm_dokter].push(item);
            return acc;
          }, {});

          const poliNames = Object.keys(grouped);
          const pagesData = [];
          for (let i = 0; i < poliNames.length; i += 2) {
            pagesData.push(poliNames.slice(i, i + 2));
          }

          let pageIndex = 0;
          function renderPage() {
            const pagePoli = pagesData[pageIndex];
            const pageHTML = `
              <div class="grid grid-cols-2 gap-8 w-full h-full overflow-auto px-10 py-6">
                ${pagePoli
                  .map(
                    (poli) => `
                  <div class="bg-white bg-opacity-90 rounded-xl shadow-md p-4 border border-blue-200">
                    <h2 class="text-2xl font-bold text-blue-700 border-b pb-2 mb-4">${poli}</h2>
                    ${Object.keys(grouped[poli])
                      .map(
                        (dokter) => `
                      <div class="mb-3">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">${dokter}</h3>
                        <ul class="space-y-1">
                          ${grouped[poli][dokter]
                            .map(
                              (pasien) => `
                              <li class="flex justify-between bg-blue-50 rounded-md px-3 py-1">
                                <span>${sensorNama(pasien.nm_pasien)}</span>
                              </li>`
                            )
                            .join('')}
                        </ul>
                      </div>`
                      )
                      .join('')}
                  </div>`
                  )
                  .join('')}
              </div>
            `;
            pages.innerHTML = pageHTML;
            pageIndex = (pageIndex + 1) % pagesData.length;
          }

          renderPage();
          setInterval(renderPage, 8000);
          lastUpdate.textContent = `Terakhir diperbarui: ${new Date().toLocaleTimeString('id-ID', { hour12: false })}`;
        }
      } catch (err) {
        console.error(err);
      }
    }

    function sensorNama(nama) {
      const parts = nama.split(' ');
      return parts.map((p) =>
        p.length > 2 ? p[0] + '*'.repeat(p.length - 2) + p.slice(-1) : p
      ).join(' ');
    }

    fetchData();
    setInterval(fetchData, 10000);
  </script>
</body>
</html>
